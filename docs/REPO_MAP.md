# Lumina Repository Map

æœ¬æ–‡æ¡£æ—¨åœ¨è¯¦å°½æè¿° Lumina é¡¹ç›®çš„ç›®å½•ç»“æ„ã€å„æ–‡ä»¶å¤¹åŠä»£ç æ–‡ä»¶çš„æ ¸å¿ƒä½œç”¨ï¼Œä½œä¸ºå¼€å‘è€…çš„å¯¼èˆªæŒ‡å—ã€‚

---

## ğŸ“‚ æ ¹ç›®å½• (Root)

| æ–‡ä»¶/ç›®å½•           | ä½œç”¨æè¿°                                                                                 |
| :------------------ | :--------------------------------------------------------------------------------------- |
| `app/`              | **Frontend (Electron/React)**ã€‚åŒ…å« UI ç»„ä»¶ã€æ¸²æŸ“è¿›ç¨‹é€»è¾‘ã€ä»¥åŠä¸åç«¯çš„é€šä¿¡æ¥å£ã€‚        |
| `python_backend/`   | **Core Backend Service**ã€‚é¡¹ç›®çš„çµé­‚ï¼ŒåŒ…å«æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ã€AI æµæ°´çº¿ã€æ’ä»¶ç®¡ç†å’Œ API æœåŠ¡ã€‚ |
| `archive/`          | **å½’æ¡£åŒº**ã€‚å­˜æ”¾å†å²é—ç•™è„šæœ¬ã€æ—§ç‰ˆæ•°æ®åº“å’Œä¸å†ä½¿ç”¨çš„å¼€å‘èµ„äº§ã€‚                           |
| `assets/`           | **é™æ€èµ„æº**ã€‚å­˜æ”¾è¯­éŸ³æ ·æœ¬ã€å›¾æ ‡ã€ä»¥åŠ UI éŸ³æ•ˆã€‚                                         |
| `config/`           | **ç³»ç»Ÿé…ç½®**ã€‚å­˜æ”¾ LLM æ³¨å†Œè¡¨ã€æœåŠ¡ç«¯å£å®šä¹‰ç­‰æ ¸å¿ƒé…ç½®æ–‡ä»¶ã€‚                              |
| `core/`             | **Electron æœåŠ¡å±‚**ã€‚æ¡¥æ¥æ¸²æŸ“è¿›ç¨‹ä¸ Python åç«¯çš„é€»è¾‘æ ¸å¿ƒï¼ˆLLM/STT/TTS/Memoryï¼‰ã€‚        |
| `docs/`             | **é¡¹ç›®æ–‡æ¡£**ã€‚å­˜æ”¾æŠ€æœ¯è§„æ ¼ä¹¦ (`TECHNICAL_REFERENCE`)ã€æ¶æ„å›¾å’Œå¼€å‘è€…æŒ‡å—ã€‚               |
| `public/`           | **é™æ€èµ„æº**ã€‚å­˜æ”¾å‰ç«¯ä½¿ç”¨çš„å›¾ç‰‡ã€å­—ä½“ã€ä»¥åŠ Live2D æ¨¡å‹èµ„æºã€‚                           |
| `scripts/`          | **è‡ªåŠ¨åŒ–è„šæœ¬**ã€‚åŒ…å«å¯åŠ¨è„šæœ¬ã€ç¯å¢ƒéªŒè¯å·¥å…·å’Œæ„å»ºé…ç½®æ–‡ä»¶ã€‚                               |
| `mcp_servers/`      | **MCP å«æ˜ŸæœåŠ¡**ã€‚ç‹¬ç«‹çš„ Model Context Protocol æœåŠ¡å™¨æ’ä»¶ã€‚                             |
| `package.json`      | å·¥ç¨‹é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰ Node.js ä¾èµ–ã€è„šæœ¬å‘½ä»¤åŠ Electron æ„å»ºé…ç½®ã€‚                          |
| `vite.config.ts`    | Vite æ„å»ºé…ç½®ï¼Œå®šä¹‰å‰ç«¯ç¼–è¯‘é€‰é¡¹å’Œåˆ«åã€‚                                                  |
| `.gitignore`        | Git å¿½ç•¥è§„åˆ™ï¼Œä¿æŠ¤æ•æ„Ÿé…ç½®ï¼ˆå¦‚ API Keyï¼‰å’Œä¸´æ—¶æ–‡ä»¶ä¸è¢«ä¸Šä¼ ã€‚                             |
| `audio_config.json` | STT/TTS éŸ³é¢‘é…ç½®ï¼ŒåŒ…å«åç«¯æœåŠ¡ç«¯å£åŠå½•éŸ³å‚æ•°ã€‚                                           |

---

## ğŸ¨ èµ„æºä¸é…ç½® (Assets & Config)

### é™æ€èµ„æº (assets/)

- **`emotion_audio/`**: æƒ…æ„Ÿè¯­éŸ³åŒ…ã€‚æ ¹æ®è§’è‰²å½“å‰æƒ…æ„ŸçŠ¶æ€è§¦å‘çš„ç‰¹å®šçŸ­è¯­å½•éŸ³ã€‚
- **`icons/`**: ç³»ç»Ÿå›¾æ ‡ã€‚ç”¨äº UI ç•Œé¢æ˜¾ç¤ºã€‚
- **`sounds/`**: UI éŸ³æ•ˆã€‚ç³»ç»Ÿå¯åŠ¨ã€æ¶ˆæ¯æ¥æ”¶ã€ç‚¹å‡»æç¤ºç­‰äº¤äº’éŸ³æ•ˆã€‚

### ç³»ç»Ÿé…ç½® (config/)

- **`llm_registry.json`**: **LLM è·¯ç”±æ³¨å†Œè¡¨**ã€‚å®šä¹‰äº†å¤šä¸ª LLM ä¾›åº”æ–¹ï¼ˆå¦‚ Pollinations, OpenAIï¼‰å¹¶å°†å®ƒä»¬è·¯ç”±åˆ°ä¸åŒçš„ä¸šåŠ¡åŠŸèƒ½ï¼ˆå¯¹è¯ã€è®°å¿†æ‘˜è¦ã€å‰ç»æ€è€ƒï¼‰ã€‚
- **`ports.json`**: **ç«¯å£å®šä¹‰**ã€‚ç»Ÿä¸€è§„å®šåç«¯å„å¾®æœåŠ¡ï¼ˆMemory, STT, TTS, SurrealDBï¼‰çš„ç›‘å¬ç«¯å£åŠä¸»æœºåœ°å€ã€‚

---

## âš™ï¸ ç³»ç»ŸæœåŠ¡ (core/)

æœ¬ç›®å½•åŒ…å« Electron ä¸»è¿›ç¨‹ä½¿ç”¨çš„é¢†åŸŸé©±åŠ¨æœåŠ¡ï¼Œä¸»è¦è´Ÿè´£å¤æ‚ä¸šåŠ¡é€»è¾‘çš„å°è£…åŠä¸ Python åç«¯çš„ IPC/WebSocket åè°ƒã€‚

- **`llm/`**:
  - **`llm_service.ts`**: LLM æ ¸å¿ƒè°ƒåº¦å™¨ã€‚æ”¯æŒæµå¼è¾“å‡ºã€ä¸Šä¸‹æ–‡æ³¨å…¥ã€ä»¥åŠåœ¨æœ¬åœ°æ¨¡å‹ä¸äº‘ç«¯ API ä¹‹é—´è¿›è¡Œ Failover åˆ‡æ¢ã€‚
- **`stt/`**:
  - **`python_stt_service.ts`**: STT ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚è´Ÿè´£ç›‘æ§åç«¯è¿›ç¨‹çŠ¶æ€ï¼Œå¹¶é€šè¿‡ WebSocket ç»´æŒä½å»¶è¿ŸéŸ³é¢‘æµä¼ è¾“ã€‚
- **`voice/`**:
  - **`tts_service.ts`**: è¯­éŸ³æ’­æ”¾æµæ°´çº¿ã€‚åŒ…å«å¥å­åˆ‡åˆ†é€»è¾‘åŠéŸ³é¢‘ç¼“å†²åŒºç®¡ç†ï¼Œç¡®ä¿è¯­éŸ³è¾“å‡ºæ— ç¼è¡”æ¥ã€‚
- **`memory/`**:
  - **`memory_service.ts`**: é•¿æœŸè®°å¿†æ¡¥æ¢ã€‚è´Ÿè´£å°†å¯¹è¯è®°å½•è½¬åŒ–ä¸ºå‘é‡è¯·æ±‚å¹¶æ¨é€åˆ° SurrealDB è¿›è¡ŒæŒä¹…åŒ–æ£€ç´¢ã€‚

---

## ğŸ’» å‰ç«¯æ¶æ„ (app/)

### æ ¸å¿ƒè¿›ç¨‹

- **`app/main/` (Electron ä¸»è¿›ç¨‹)**:
  - **`main.ts`**: ç¨‹åºå…¥å£ã€‚è´Ÿè´£çª—å£ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€Python åç«¯æœåŠ¡å¯åŠ¨ç¼–æ’ï¼Œä»¥åŠå¤„ç†æ¸²æŸ“è¿›ç¨‹åˆ†å‘çš„ IPC è¯·æ±‚ï¼ˆå¦‚ LLM å¯¹è¯ã€è®¾ç½®åŒæ­¥ï¼‰ã€‚
  - **`preload.ts`**: å®‰å…¨ç½‘æ¡¥ã€‚å®šä¹‰äº†æš´éœ²ç»™æ¸²æŸ“è¿›ç¨‹çš„ API å®‰å…¨æ¥å£ã€‚
  - **`config_store.ts`**: é…ç½®æŒä¹…åŒ–ã€‚åŸºäº `electron-store` å­˜å‚¨ API Keyã€æ¨¡å‹åå¥½ç­‰æœ¬åœ°è®¾ç½®ã€‚
- **`app/renderer/` (React æ¸²æŸ“è¿›ç¨‹)**:
  - **`App.tsx`**: UI æ ¹ç»„ä»¶ã€‚ç®¡ç†å…¨å±€æ˜¾ç¤ºé€»è¾‘åŠæ ¸å¿ƒ Hook çš„åˆå§‹åŒ–ã€‚
  - **`core/events.ts`**: å…¨å±€äº‹ä»¶æ€»çº¿ã€‚å¤„ç†éŸ³é¢‘ VAD çŠ¶æ€ã€æ„ŸçŸ¥è¯†åˆ«ç»“æœåŠ UI æŒ‡ä»¤çš„è§£è€¦é€šä¿¡ã€‚
  - **`hooks/`**: ä¸šåŠ¡é€»è¾‘å±‚ã€‚åŒ…å« `useGateway` (æ•°æ®åˆ†å‘)ã€`useAudioPipeline` (éŸ³é¢‘æµæ§) ç­‰æ ¸å¿ƒçŠ¶æ€é€»è¾‘ã€‚
  - **`components/`**: UI ç»„ä»¶åº“ã€‚åŒ…å«å¯¹è¯æ¡†ã€Live2D ç”»å¸ƒåŠæ§åˆ¶é¢æ¿ã€‚

---

## ğŸ¨ å‰ç«¯èµ„äº§ä¸è¿è¡Œæ—¶ (public/)

æœ¬ç›®å½•åŒ…å«æµè§ˆå™¨ç›´æ¥åŠ è½½çš„é™æ€èµ„æºã€ä½çº§è¿è¡Œæ—¶åº“ä»¥åŠè¾¹ç¼˜ä¾§è¿è¡Œçš„æ¨¡å‹æ–‡ä»¶ã€‚

- **`live2d/`**: **Live2D æ¨¡å‹åº“**ã€‚å­˜æ”¾æ‰€æœ‰å¯é€‰è§’è‰²çš„ `.model3.json` åŠå…¶çº¹ç†èµ„æºï¼ˆå¦‚ Hiyori, PinkFoxï¼‰ã€‚
- **`vrm/`**: **3D æ¨¡å‹åº“**ã€‚å­˜æ”¾ç¬¦åˆ VRM è§„æ ¼çš„ 3D è§’è‰²æ¨¡å‹ã€‚
- **`libs/`**: **åº•å±‚è¿è¡Œåº“**ã€‚åŒ…å« `live2dcubismcore.min.js` ç­‰é—­æº SDK æ ¸å¿ƒã€‚
- **è¾¹ç¼˜ä¾§ VAD (Voice Activity Detection)**:
  - **`real-time-vad.js`**: æµè§ˆå™¨ç«¯å®æ—¶è¯­éŸ³æ´»æ€§æ£€æµ‹é€»è¾‘ã€‚
  - **`silero_vad_v5.onnx`**: Silero VAD ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œç”¨äºåœ¨å‰ç«¯ä½åŠŸè€—è¯†åˆ«ç”¨æˆ·æ˜¯å¦æ­£åœ¨è¯´è¯ã€‚
  - **`ort-wasm-*.wasm`**: ONNX Runtime çš„ WebAssembly ç¼–è¯‘äº§ç‰©ï¼Œä¸ºæµè§ˆå™¨æä¾›è¿‘ä¹åŸç”Ÿçš„æ¨¡å‹æ¨ç†æ€§èƒ½ã€‚

---

## ğŸ åç«¯æ ¸å¿ƒ (python_backend/)

Lumina çš„åç«¯é‡‡ç”¨åˆ†å±‚æ¶æ„ï¼Œé›†æˆäº† FastAPI æœåŠ¡ã€é«˜æ€§èƒ½è¯­éŸ³å¾®æœåŠ¡ä»¥åŠåŸºäºæ’ä»¶çš„é¢†åŸŸé©±åŠ¨è®¾è®¡ (DDD) é€»è¾‘ã€‚

### æ ¸å¿ƒå¾®æœåŠ¡ (Entry Points)

- **`main.py`**: **ä¸»åº”ç”¨ç½‘å…³**ã€‚è¿è¡ŒåŸºäº FastAPI çš„ HTTP/WebSocket æ¥å£ï¼Œå¤„ç† REST è¯·æ±‚å¹¶ç¼–æ’å…¨å±€ä¸šåŠ¡çŠ¶æ€ã€‚
- **`stt_server.py`**: **è¯­éŸ³è¯†åˆ«å¼•æ“**ã€‚ç‹¬ç«‹è¿›ç¨‹è¿è¡Œï¼ŒåŸºäº SenseVoice å®ç°é«˜ç²¾åº¦å®æ—¶éŸ³é¢‘è½¬å½•ï¼Œå¹¶æ‰˜ç®¡ VAD åç«¯æ£€æµ‹é€»è¾‘ã€‚
- **`tts_server.py`**: **è¯­éŸ³åˆæˆå¼•æ“**ã€‚ç‹¬ç«‹è¿›ç¨‹è¿è¡Œï¼Œé©±åŠ¨ GPT-SoVITS åŠå…¶å®ƒç¥ç»è¯­éŸ³é©±åŠ¨ï¼Œæ”¯æŒé›¶å»¶è¿Ÿæµå¼éŸ³é¢‘æ¨é€ã€‚
- **`backend_launcher.py`**: **è¿›ç¨‹ç®¡ç†å™¨**ã€‚è´Ÿè´£ä¸»ä»å¾®æœåŠ¡çš„ååŒå¯åŠ¨ã€å¥åº·æ£€æŸ¥ä»¥åŠä¼˜é›…é€€å‡ºã€‚

### æ¶æ„æ¡†æ¶ (core/)

- **`bootstrap/`**: **ç”Ÿå‘½å‘¨æœŸå¼•å¯¼**ã€‚å®ç°åŸºç¡€è®¾æ–½ï¼ˆDBã€EventBusï¼‰åˆ°æ ¸å¿ƒæœåŠ¡çš„æœ‰åºä¾èµ–æ³¨å…¥ã€‚
- **`events/`**: **å¼‚æ­¥äº‹ä»¶æ€»çº¿**ã€‚æä¾›åŸºäºæ¶ˆæ¯é©±åŠ¨çš„ç»„ä»¶é€šä¿¡æœºåˆ¶ï¼Œå®ç° UI æŒ‡ä»¤ä¸ä¸šåŠ¡é€»è¾‘çš„è§£è€¦ã€‚
- **`db/`**: **æŒä¹…åŒ–å±‚**ã€‚å°è£…å¯¹ SurrealDB çš„åº•å±‚è¿æ¥ä¸è¿æ¥æ± ç®¡ç†ã€‚
- **`interfaces/`**: **å¥‘çº¦å®šä¹‰**ã€‚åŒ…å«æ’ä»¶ã€é©±åŠ¨åŠæœåŠ¡çš„æŠ½è±¡åŸºç±»ï¼Œç¡®ä¿ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€‚
- **`isolation/`**: **æ’ä»¶æ²™ç®±**ã€‚æä¾›åŸºäº `multiprocessing` çš„è¿›ç¨‹çº§éš”ç¦»è¿è¡Œç¯å¢ƒï¼Œç¡®ä¿ç¬¬ä¸‰æ–¹æ’ä»¶ä¸å¹²æ‰°ä¸»ç³»ç»Ÿç¨³å®šæ€§ã€‚

### ä¸šåŠ¡ä¸æ™ºèƒ½ (services/ & AI)

- **`services/`**:
  - **`container.py`**: **ä¾èµ–æ³¨å…¥å®¹å™¨**ã€‚ä¸­å¤®æœåŠ¡æ³¨å†Œè¡¨ï¼Œæ§åˆ¶æ‰€æœ‰æ ¸å¿ƒç»„ä»¶çš„å®ä¾‹åŒ–ä¸ç”Ÿå­˜æœŸã€‚
  - **`soul/`**: **çµé­‚å¼•æ“é€»è¾‘**ã€‚å®šä¹‰è§’è‰²çš„äººæ ¼ã€çŸ­æœŸæƒ…ç»ªæ³¢åŠ¨ä»¥åŠå¯¹è¯é£æ ¼åå¥½ã€‚
  - **`chat/`**: **å¯¹è¯æµæ°´çº¿**ã€‚åŒ…å«åŸºäº Pipes & Filters æ¨¡å¼çš„ `unified_chat.py` é€»è¾‘ã€‚
- **`llm/`**: **æ¨¡å‹é©±åŠ¨å±‚**ã€‚å±è”½ OpenAIã€DeepSeekã€Pollinations ç­‰ä¸åŒ API çš„åè®®å·®å¼‚ã€‚
- **`memory/`**: **è®°å¿†ç³»ç»Ÿ**ã€‚å®ç°å‘é‡å­˜å‚¨ (Vector DB) ä¸çŸ¥è¯†å›¾è°± (Knowledge Graph) çš„æ··åˆæ£€ç´¢é€»è¾‘ã€‚
- **`soul_manager.py`**: **è§’è‰²çŠ¶æ€ä¸­æ¢**ã€‚ç»Ÿç­¹äººè®¾æ›´æ–°ã€é•¿æœŸè®°å¿†æ¼”åŒ–ä»¥åŠæƒ…æ„Ÿå†³ç­–é€»è¾‘ã€‚

### è·¯ç”±ä¸é…ç½® (routers/ & config)

- **`routers/`**:
  - **`gateway.py`**: WebSocket ä¸­å¤®ç½‘å…³ï¼Œè´Ÿè´£å‘æ¸²æŸ“è¿›ç¨‹åˆ†å‘å®æ—¶è¯­éŸ³ã€åŠ¨ç”»åŠçŠ¶æ€åŒ…ã€‚
  - **`llm_mgmt.py`**: è¿è¡Œæ—¶æ¨¡å‹é…ç½®ç®¡ç†ï¼Œç”¨äºåŠ¨æ€åˆ‡æ¢ AI ä¾›åº”å•†ã€‚
- **`app_config.py`**: **å¼ºç±»å‹é…ç½®ä¸­å¿ƒ**ã€‚åŸºäº Pydantic è§£æ `.env` åŠæœ¬åœ° JSON è®¾ç½®ã€‚
- **`logger_setup.py`**: å®ç°å¤šè¿›ç¨‹ã€å¤šæœåŠ¡çš„æ—¥å¿—æ”¶é›†ä¸ RequestID é“¾è·¯è¿½è¸ªã€‚

---

## ğŸ—ï¸ ç³»ç»Ÿæ’ä»¶ (plugins/)

Lumina æ‹¥æœ‰å¼ºå¤§çš„æ’ä»¶åŒ–ç”Ÿæ€ï¼Œåˆ†ä¸ºæ ¸å¿ƒé©±åŠ¨ä¸æ‰©å±•åŠŸèƒ½ï¼š

- **`drivers/`**: åŒ…å«ç¡¬ä»¶ã€LLM Provider åŠæ„ŸçŸ¥æ¨¡å—çš„å…·ä½“é©±åŠ¨å®ç°ã€‚
- **`extensions/`**: åŸºäº V2 æ’ä»¶åè®®çš„åŠŸèƒ½æ‰©å±•ï¼ˆå¦‚ MCP æ¡¥æ¥ã€å¤–éƒ¨ API é›†æˆï¼‰ã€‚
- **`system/`**: ç³»ç»Ÿçº§æ’ä»¶ï¼Œå¦‚ `voiceprint`ï¼ˆå£°çº¹è¯†åˆ«ï¼‰å’Œ `cognitive`ï¼ˆè®¤çŸ¥å±‚å¢å¼ºï¼‰ã€‚

---

## ğŸ› ï¸ è‡ªåŠ¨åŒ–ä¸å·¥å…· (scripts/)

- **`start_backend.ps1`**: ä¸€é”®å¯åŠ¨è„šæœ¬ã€‚å¹¶å‘å¯åŠ¨ `main`, `stt`, `tts` æœåŠ¡ã€‚
- **`verification/`**: ç¯å¢ƒéªŒè¯è„šæœ¬ã€‚ç”¨äºæµ‹è¯•æ•°æ®åº“è¿æ¥ã€API é€šä¿¡åŠç¡¬ä»¶é©±åŠ¨çŠ¶æ€ã€‚
- **`build_config/`**: å­˜æ”¾ PyInstaller çš„ `.spec` æ–‡ä»¶ï¼Œç”¨äºæ‰“åŒ…åç«¯å¯æ‰§è¡Œæ–‡ä»¶ã€‚
- **`generate_api_client.ps1`**: è‡ªåŠ¨åŒ–å·¥å…·ã€‚æ ¹æ® FastAPI çš„ OpenAPI schema è‡ªåŠ¨ç”Ÿæˆå‰ç«¯ TypeScript ç±»å‹ã€‚

---

## ğŸ“¦ å­˜å‚¨ä¸æ•°æ® (data/)

- **`characters/`**: è§’è‰²å®šä¹‰ã€‚å­˜æ”¾ä¸åŒè§’è‰²çš„ `identity.yaml`, `style.yaml` å’Œ `state.json`ã€‚
- **`sessions/`**: å¯¹è¯ä¼šè¯ã€‚å­˜æ”¾ç”¨æˆ·èŠå¤©è®°å½•çš„æŒä¹…åŒ– JSONã€‚
- **`temp/`**: è¿è¡Œæ—¶ä¸´æ—¶æ–‡ä»¶ï¼Œå¦‚ä¸´æ—¶å½•éŸ³ç‰‡æ®µã€‚

---

## ğŸ“¡ æ’ä»¶ä¸æ‰©å±•

- **`plugins/system/`**:
  - `galgame/`: æ¸¸æˆé€»è¾‘å¢å¼ºï¼ˆèƒ½é‡ç³»ç»Ÿã€å¥½æ„Ÿåº¦ï¼‰ã€‚
  - `cognitive/`: è®¤çŸ¥å±‚æ’ä»¶ï¼Œå¤„ç†é•¿çŸ­æœŸè®°å¿†å†³ç­–ã€‚
  - `voiceprint/`: å£°çº¹è¯†åˆ«é©±åŠ¨åŠç­–ç•¥ã€‚
- **`mcp_servers/`**:
  - `bilibili/`: æ¥å…¥ B ç«™åŠ¨æ€ä¸è¯„è®ºã€‚
  - `memory_viewer/`: è®°å¿†ç³»ç»Ÿå¯è§†åŒ–è¾…åŠ©ã€‚

---

> [!TIP]
> ç»†èŠ‚è¯´æ˜ï¼šæ‰€æœ‰æ–°å¢éªŒè¯è„šæœ¬è¯·æ”¾å…¥ `scripts/verification`ï¼›æ–°å¢è§’è‰²å®šä¹‰è¯·æ”¾å…¥ `python_backend/characters/`ã€‚
