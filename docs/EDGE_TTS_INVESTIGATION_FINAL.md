# Edge TTS 情感功能调查报告 - 最终结论

## 🔍 问题根源

用户反馈截图显示:**SSML 标签被当成普通文本朗读**

示例:系统朗读出 "Verm mistake version 1.0, xmlns 2.http 3.w3.org..."

## 调查结果

### 关键发现

经过以下测试:
1. ✅ 代码实现验证 - 我们的 SSML 生成逻辑正确
2. ✅ edge-tts API 测试 - 参数 `rate` / `pitch` / `volume` 有效
3. ❌ SSML `express-as` 测试 - **完全无效**

### 根本原因(来自 GitHub)

**edge-tts 库 Issue #426**: 
> "SSML with \u003cmstts:express-as\u003e style plays default text instead of provided text"

**官方答复**:
> "Support for custom SSML was removed because Microsoft prevents the use of any SSML that could not be generated by Microsoft Edge itself."

**技术限制**:
- Microsoft Edge TTS 免费 API **只允许**:
  - 单个 `<voice>` 标签
  - 单个 `<prosody>` 标签(音调/语速/音量)
- **禁止使用**:
  - `<mstts:express-as style='...'>` (情感样式)
  - 其他高级 SSML 功能

**这些功能仅在付费的 Azure Cognitive Services Speech API 中可用。**

---

## 📊 对比分析

| 特性 | Edge TTS (免费) | Azure TTS (付费) | GPT-SoVITS (本地) |
|------|----------------|------------------|-------------------|
| 情感样式 | ❌ 不支持 | ✅ 支持 | ✅ 极强 |
| 费用 | 免费 | $15/百万字符 | 免费(硬件成本) |
| 延迟 | ~200ms | ~300ms | ~500ms |
| 配置难度 | 简单 | 中等 | 复杂 |
| 本地部署 | ❌ | ❌ | ✅ |

---

## 🎯 结论与建议

### Edge TTS 的真实能力

**✅ 能做的**:
- 高质量语音合成
- 调节语速 (`rate`)
- 调节音调 (`pitch`)
- 调节音量 (`volume`)

**❌ 不能做的**:
- **情感样式** (cheerful, sad, angry, etc.)
- **高级 SSML** (express-as, audio, etc.)

### 三种解决方案

#### 方案 A: 接受 Edge TTS 的局限 ✅ 最简单
**适用场景**:情感要求不高,接受"机械化"的语音

**实现方式**:
- 保留当前 Edge TTS
- 通过 `rate`/`pitch` 进行微调(有限效果)
- **主要依靠 Live2D 动作表达情感**

**工作量**:0 小时(当前状态)

---

#### 方案 B: 使用 Azure Cognitive Services TTS 💰 付费
**适用场景**:需要云端情感 TTS,愿意付费

**优点**:
- ✅ 支持所有情感样式
- ✅ 官方支持,稳定可靠
- ✅ 配置简单(改 API 端点即可)

**缺点**:
- ❌ 需要付费(约 $0.015/1000 字符)
- ❌ 需要 Azure 账户

**工作量**:1 小时(注册 Azure + 修改配置)

---

#### 方案 C: 部署 GPT-SoVITS ⭐ 推荐
**适用场景**:需要本地高情感 TTS,一次性投入时间

**优点**:
- ✅ 情感表现力**极强**(可模仿任何语气)
- ✅ 完全本地,无隐私顾虑
- ✅ 可克隆特定角色声音
- ✅ 长期免费

**缺点**:
- ⚠️ 初次配置需 2-3 小时
- ⚠️ 需要 GPU(4-6GB 显存)

**工作量**:2-3 小时(首次部署)

**实施步骤预览**:
1. 安装 GPT-SoVITS
2. 准备情感参考音频(每种情感 5-10 秒)
3. 集成到 Lumina TTS 服务
4. 测试验证

---

## 🤔 如何决策?

### 如果你...

**重视开发速度 > 情感表现**
→ **选择方案 A**(保留 Edge TTS)
→ 接受无情感语音,通过 Live2D 补偿

**有预算 + 需要云端方案**
→ **选择方案 B**(Azure TTS)
→ 快速获得情感功能,按量付费

**重视情感 + 有时间配置 + 有 GPU**
→ **选择方案 C**(GPT-SoVITS)⭐
→ 一次性投入,长期受益

---

## 📝 下一步

请选择一个方案,我会提供对应的:
- 详细实施指南
- 代码修改方案
- 测试验证步骤

**当前状态**:
- ✅ Edge TTS 基础功能正常(无情感)
- ✅ 代码架构已预留其他 TTS 引擎接口
- ✅ 情感映射配置已完成(可复用)

**推荐**:
基于你"听不出区别"的反馈,我建议**方案 C(GPT-SoVITS)**。

如果你现在想部署,我会:
1. 提供一键部署脚本
2. 帮助准备参考音频
3. 完成集成和测试

---

## 附录:测试文件位置

**已生成的测试音频**:
- `python_backend/unified_test/` - 8 个情感测试(Edge TTS)
- `python_backend/ssml_verification/` - 4 个 SSML 验证(证明不支持)
- `python_backend/extreme_test/` - 极限对比测试

**测试脚本**:
- `test_edge_tts_api.py` - API 参数测试
- `verify_edge_tts_ssml.py` - SSML 支持验证
