# Galgame Plot Plugin - 概念设计方案 (Conceptual Design)

本方案旨在为 Lumina 添加剧情管理功能,使 AI 能够在不脱轨的情况下推进故事,并深度整合现有的亲密度、能量和情绪系统。

## 1. 核心机制:混合叙事架构 (Hybrid Narrative Architecture)

为了确保存剧情的**深刻性**和**情感张力**,我们将放弃"纯 AI 生成故事",转而采用"专业骨架 + AI 演绎"的混合模式:

- **专业骨架 (Professional Spine)**:
  - 开发者预设一系列 **"情感锚点 (Emotional Anchors)"**(例如:深夜操场上的秘密、关于离别的预感、雨中的争执)。
  - 这些锚点由人类编剧(或由 AI 辅助生成的固定剧本)编写,定义了剧情的最高峰和关键转场。
- **AI 演绎 (AI Performance & Flesh)**:
  - AI 的主要职责不是"编故事",而是"演好每一场戏"。
  - **动态填充**: AI 负责根据当日的实际天气、玩家最近的对话、以及角色的 PAD 状态,动态生成达到 these 锚点的路径。
  - **即兴表现**: 在"专业骨架"定义的范围内,AI 拥有极高的自由度来表现角色的细腻情感。
- **主题倾向 (Thematic Bias)**:
  - 系统为导演层引入"主题设定"(如:救赎、克制的爱、成长的烦恼)。
  - 导演层会像一位文学导师,不断的微调 Prompt,引导 AI 往这些深刻的主题上靠拢,而不是陷入苍白的日常白话。

## 2. 交互体验:情感化 UI (Emotional UI)

- **慢节奏设计**: 剧情关键节点支持"慢速打字机"和"环境音效",强制营造沉浸感。
- **表情联动**: 深度关联 Live2D 的微表情。深刻的对话不一定要大声疾呼,有时一个"眼神闪躲"加上短短的省略号,比千言万语更动人。
- **任务提示栏 (`InnerVoice`)**: 将"任务目标"包装成玩家或角色的"内心独白",而非机械的任务指令。

---

## 3. 记忆固化:深刻事件的"灵魂烙印"

- **非事实 memory (Emotional Values)**: 不仅记录"发生了什么",更记录"心境的变化"。
  - SurrealDB 中会存储 `Emotional_Mark`,记录此刻角色受到的震撼或触动。
- **关系升格**: 剧情结束后,可能会触发 `Relationship_Tag` 的质变(如:从"朋友"变为"不可替代的人")。

---

## 4. 现有数值的深度融合 (Value Integration)

- **亲密度 (Level)**: 决定角色是否愿意在剧情中展露内心的"阴影"或"脆弱"。
- **能量 (Energy)**: 决定剧情冲突的爆发力。
- **PAD**: 决定情感表达的冷暖底色。

---

## 5. 开源项目参考总结 (LingChat 分析)

- **核心借鉴**: `LingChat` 通过 `plot_outline` 变量预先规划了三幕剧结构。
- **Lumina 改进**: 我们的导演层是"动态编剧",它会在对话过程中根据玩家的反馈实时修正后续的大纲,而不是死板地执行一个大纲。

---

## 6. 开源项目推荐与灵感参考

1. **[Ink (by Inkle)](https://www.inklestudios.com/ink/)**:

   - 这是专业级别的叙事脚本语言。不需要完全搬运,但其 `Stitch`, `Knot` 和 `Choice` 的逻辑非常适合 AI 剧情。
   - 灵感:可以尝试用 LLM 将 Ink 脚本转译为 Lumina 可理解的 Node 系统。

2. **[SillyTavern - World Info / Lorebook](https://docs.sillytavern.app/)**:

   - 其管理世界观和角色一致性的机制非常成熟。
   - 灵感:利用 Lorebook 存储剧情背景,按需加载。

3. **[Narrat](https://narrat.dev/)**:
   - 一个精简的 Web 剧情引擎。它的配置文件结构非常清晰,可以参考其如何组织剧情流。
